<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Expand a 'type' column in a dataframe — expand_types • n2khab</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Expand a 'type' column in a dataframe — expand_types" />
<meta property="og:description" content="Takes a dataframe with a column of type codes
(main type or subtype codes),
and, under certain conditions, adds new rows with codes of the associated
subtypes and main types, respectively.
It allows to do sensible selections and joins with interpreted forms of the
habitatmap_stdized and watersurfaces data sources:
habitatmap_terr,
read_watersurfaces_hab(interpreted = TRUE).
If the dataframe has one or more grouping variables, by default the
operation is done independently for each group in turn." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">n2khab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/v010_reference_lists.html">Reference lists and using them</a>
    </li>
    <li>
      <a href="../articles/v020_datastorage.html">Where to store the N2KHAB input data sources</a>
    </li>
    <li>
      <a href="../articles/v025_geospatial_hab.html">Working with geospatial data sources of habitat (sub)types and RIBs</a>
    </li>
    <li>
      <a href="../articles/v030_GRTSmh.html">Using the GRTS data sources</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/inbo/n2khab">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Expand a 'type' column in a dataframe</h1>
    <small class="dont-index">Source: <a href='https://github.com/inbo/n2khab/blob/master/R/datawrangling.R'><code>R/datawrangling.R</code></a></small>
    <div class="hidden name"><code>expand_types.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Takes a dataframe with a column of type codes
(<em>main type</em> or <em>subtype </em>codes),
and, under certain conditions, adds new rows with codes of the associated
<em>subtypes</em> and <em>main types</em>, respectively.
It allows to do sensible selections and joins with interpreted forms of the
<code>habitatmap_stdized</code> and <code>watersurfaces</code> data sources:
<code>habitatmap_terr</code>,
<code><a href='read_watersurfaces_hab.html'>read_watersurfaces_hab(interpreted = TRUE)</a></code>.
If the dataframe has one or more grouping variables, by default the
operation is done independently for each group in turn.</p>
    </div>

    <pre class="usage"><span class='fu'>expand_types</span>(<span class='no'>x</span>, <span class='kw'>type_var</span> <span class='kw'>=</span> <span class='st'>"type"</span>, <span class='kw'>use_grouping</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>strict</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An object of class <code>data.frame</code>.</p></td>
    </tr>
    <tr>
      <th>type_var</th>
      <td><p>A string.
The name of the dataframe variable that holds the type codes.
Defaults to <code>type</code>.</p></td>
    </tr>
    <tr>
      <th>use_grouping</th>
      <td><p>Logical.
If the dataframe has one or more grouping variables
(class <code>grouped_df</code>),
is the operation to be performed independently
for each group in turn?</p></td>
    </tr>
    <tr>
      <th>strict</th>
      <td><p>Logical.
Apply conditions before expanding subtype codes to main type codes?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A dataframe, either identical or longer than the input dataframe.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The extra rows in the dataframe take the values for other variables
from the rows with which they are associated, based on the
subtype - main type relation.
Type codes in the dataframe are verified to comply with the codes from the
<code><a href='types.html'>types</a></code> data source.
A warning is given when they don't.</p>
<p>Main type codes are always expanded with the subtype codes that belong to it.</p>
<p>The applied approach to add main type codes only makes sense
assuming that the result is to be confronted
with one of the <em>above listed</em> geospatial data sources.</p>
<p>In order to add main type codes based on
subtype codes that are present in the type column, specific conditions have
to be met:</p><ul>
<li><p>for 2330: both subtype codes must be present</p></li>
<li><p>for 6230: 6230_ha, 6230_hmo and 6230_hnk must be present
(not the rare 6230_hnk)</p></li>
<li><p>for 91E0: 91E0_va, 91E0_vm and 91E0_vn must be present
(not the rarer 91E0_sf, 91E0_vc and 91E0_vo)</p></li>
</ul><p>However, it is possible to relax this requirement by setting
<code>strict = FALSE</code>.
This will add the main type code whenever <em>one</em> corresponding subtype
code is present.
In all cases no other main type codes are added apart from
2330, 6230 and 91E0.
This is because the data sources with which the result
is to be matched (see Description) don't contain certain main type codes,
and because it makes no sense in other cases
(rbbkam, rbbvos, rbbzil &amp; 9120 in the <code>habitatmap</code> do not refer to a
main type but to an non-defined subtype with no specific code).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='read_scheme_types.html'>read_scheme_types</a></code>,
<code><a href='read_types.html'>read_types</a></code>,
<code><a href='read_habitatmap_terr.html'>read_habitatmap_terr</a></code>,
<code><a href='read_watersurfaces_hab.html'>read_watersurfaces_hab</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'><span class='no'>x</span> <span class='kw'>&lt;-</span>
    <span class='fu'><a href='read_scheme_types.html'>read_scheme_types</a></span>() <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>scheme</span> <span class='kw'>==</span> <span class='st'>"GW_05.1_terr"</span>)
<span class='fu'>expand_types</span>(<span class='no'>x</span>)</div><div class='output co'>#&gt; # A tibble: 61 x 5
#&gt;    scheme    type    typegroup      typegroup_name             typegroup_shortn…
#&gt;    &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;          &lt;fct&gt;                      &lt;fct&gt;            
#&gt;  1 GW_05.1_… 1310_p… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  2 GW_05.1_… 1310_zk GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  3 GW_05.1_… 1310_zv GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  4 GW_05.1_… 1320    GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  5 GW_05.1_… 1330_da GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  6 GW_05.1_… 1330_h… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  7 GW_05.1_… 2130_h… GW_05.1_terr_… types from dry environmen… dry              
#&gt;  8 GW_05.1_… 2130_hd GW_05.1_terr_… types from dry environmen… dry              
#&gt;  9 GW_05.1_… 2160    GW_05.1_terr_… types from moist environm… moist            
#&gt; 10 GW_05.1_… 2170    GW_05.1_terr_… types from moist environm… moist            
#&gt; # … with 51 more rows</div><div class='input'><span class='fu'>expand_types</span>(<span class='no'>x</span>, <span class='kw'>strict</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A tibble: 62 x 5
#&gt;    scheme    type    typegroup      typegroup_name             typegroup_shortn…
#&gt;    &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;          &lt;fct&gt;                      &lt;fct&gt;            
#&gt;  1 GW_05.1_… 1310_p… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  2 GW_05.1_… 1310_zk GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  3 GW_05.1_… 1310_zv GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  4 GW_05.1_… 1320    GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  5 GW_05.1_… 1330_da GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  6 GW_05.1_… 1330_h… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  7 GW_05.1_… 2130_h… GW_05.1_terr_… types from dry environmen… dry              
#&gt;  8 GW_05.1_… 2130_hd GW_05.1_terr_… types from dry environmen… dry              
#&gt;  9 GW_05.1_… 2160    GW_05.1_terr_… types from moist environm… moist            
#&gt; 10 GW_05.1_… 2170    GW_05.1_terr_… types from moist environm… moist            
#&gt; # … with 52 more rows</div><div class='input'>
<span class='no'>x</span> <span class='kw'>&lt;-</span>
    <span class='fu'><a href='read_scheme_types.html'>read_scheme_types</a></span>() <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>scheme</span> <span class='kw'>==</span> <span class='st'>"GW_05.1_terr"</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>typegroup</span>)
<span class='fu'>expand_types</span>(<span class='no'>x</span>)</div><div class='output co'>#&gt; # A tibble: 58 x 5
#&gt; # Groups:   typegroup [5]
#&gt;    scheme    type    typegroup      typegroup_name             typegroup_shortn…
#&gt;    &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;          &lt;fct&gt;                      &lt;fct&gt;            
#&gt;  1 GW_05.1_… 1310_p… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  2 GW_05.1_… 1330_h… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  3 GW_05.1_… 4010    GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  4 GW_05.1_… rbbsm   GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  5 GW_05.1_… 6410_mo GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  6 GW_05.1_… 6410_ve GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  7 GW_05.1_… 6430_hf GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  8 GW_05.1_… 6430_hw GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  9 GW_05.1_… rbbhc   GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt; 10 GW_05.1_… rbbhf   GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt; # … with 48 more rows</div><div class='input'><span class='fu'>expand_types</span>(<span class='no'>x</span>, <span class='kw'>use_grouping</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>) <span class='co'># equals above example</span></div><div class='output co'>#&gt; # A tibble: 61 x 5
#&gt; # Groups:   typegroup [5]
#&gt;    scheme    type    typegroup      typegroup_name             typegroup_shortn…
#&gt;    &lt;fct&gt;     &lt;fct&gt;   &lt;fct&gt;          &lt;fct&gt;                      &lt;fct&gt;            
#&gt;  1 GW_05.1_… 1310_p… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  2 GW_05.1_… 1310_zk GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  3 GW_05.1_… 1310_zv GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  4 GW_05.1_… 1320    GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  5 GW_05.1_… 1330_da GW_05.1_terr_… types from very wet envir… very wet         
#&gt;  6 GW_05.1_… 1330_h… GW_05.1_terr_… types from moderately wet… moderately wet   
#&gt;  7 GW_05.1_… 2130_h… GW_05.1_terr_… types from dry environmen… dry              
#&gt;  8 GW_05.1_… 2130_hd GW_05.1_terr_… types from dry environmen… dry              
#&gt;  9 GW_05.1_… 2160    GW_05.1_terr_… types from moist environm… moist            
#&gt; 10 GW_05.1_… 2170    GW_05.1_terr_… types from moist environm… moist            
#&gt; # … with 51 more rows</div><div class='input'>
<span class='no'>x</span> <span class='kw'>&lt;-</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/reexports.html'>tribble</a></span>(
        ~<span class='no'>mycode</span>, ~<span class='no'>obs</span>,
        <span class='st'>"2130"</span>, <span class='fl'>5</span>,
        <span class='st'>"2190"</span>, <span class='fl'>45</span>,
        <span class='st'>"2330_bu"</span>, <span class='fl'>8</span>,
        <span class='st'>"2330_dw"</span>, <span class='fl'>8</span>,
        <span class='st'>"6410_mo"</span>, <span class='fl'>78</span>,
        <span class='st'>"6410_ve"</span>, <span class='fl'>4</span>,
        <span class='st'>"91E0_vn"</span>, <span class='fl'>10</span>
    )
<span class='fu'>expand_types</span>(<span class='no'>x</span>, <span class='kw'>type_var</span> <span class='kw'>=</span> <span class='st'>"mycode"</span>)</div><div class='output co'>#&gt; # A tibble: 13 x 2
#&gt;    mycode        obs
#&gt;    &lt;chr&gt;       &lt;dbl&gt;
#&gt;  1 2130            5
#&gt;  2 2190           45
#&gt;  3 2330_bu         8
#&gt;  4 2330_dw         8
#&gt;  5 6410_mo        78
#&gt;  6 6410_ve         4
#&gt;  7 91E0_vn        10
#&gt;  8 2130_had        5
#&gt;  9 2130_hd         5
#&gt; 10 2190_a         45
#&gt; 11 2190_mp        45
#&gt; 12 2190_overig    45
#&gt; 13 2330            8</div><div class='input'><span class='fu'>expand_types</span>(<span class='no'>x</span>, <span class='kw'>type_var</span> <span class='kw'>=</span> <span class='st'>"mycode"</span>, <span class='kw'>strict</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A tibble: 14 x 2
#&gt;    mycode        obs
#&gt;    &lt;chr&gt;       &lt;dbl&gt;
#&gt;  1 2130            5
#&gt;  2 2190           45
#&gt;  3 2330_bu         8
#&gt;  4 2330_dw         8
#&gt;  5 6410_mo        78
#&gt;  6 6410_ve         4
#&gt;  7 91E0_vn        10
#&gt;  8 2130_had        5
#&gt;  9 2130_hd         5
#&gt; 10 2190_a         45
#&gt; 11 2190_mp        45
#&gt; 12 2190_overig    45
#&gt; 13 2330            8
#&gt; 14 91E0           10</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Floris Vanderhaeghe, Toon Westra, Hans Van Calster.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


